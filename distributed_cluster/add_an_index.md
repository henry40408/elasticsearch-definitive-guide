# 新增索引

為了將資料新增到 Elasticsearch，我們需要 **索引(index)** —— 儲存關聯資料的地方。實際上，索引只是一個 **邏輯名稱空間(logical namespace)**，它指向一個或多個 **分片(shards)**。

**分片(shard)** 是 **工作單元(worker unit)** 底層的一員，它只負責儲存索引中所有資料的一小片。在接下來的《深入分片》一章中，我們還將深入學習分片是如何運作的，但是現在你只要知道分片是一個獨立的Lucene例項既可，並且它自身也是一個完整的搜尋引擎。我們的文件儲存並且被索引在分片中，但是我們的程式並不會直接與它們通訊。取而代之，它們直接與索引進行通訊的。

在 elasticsearch 中，分片用來分配叢集中的資料。把分片想象成一個資料的容器。資料被儲存在分片中，然後分片又被分配在叢集的節點上。當你的叢集擴充套件或者縮小時，elasticsearch 會自動的在節點之間遷移分配分片，以便叢集保持均衡。

分片分為 **主分片(primary shard)** 以及 **從分片(replica shard)** 兩種。在你的索引中，每一個文件都屬於一個主分片，所以具體有多少主分片取決於你的索引能儲存多少資料。

> 雖然理論上主分片對儲存多少資料是沒有限制的。分片的最大數量完全取決於你的實際狀況：硬體的配置、文件的大小和複雜度、如何索引和查詢你的文件，以及你期望的響應時間。

從分片只是主分片的一個副本，它用於提供資料的冗餘副本，在硬體故障時提供資料保護，同時服務於搜尋和檢索這種只讀請求。

索引中的主分片的數量在索引建立後就固定下來了，但是從分片的數量可以隨時改變。

接下來，我們在空的單節點叢集中上建立一個叫做 `blogs` 的索引。一個索引預設設定了5個主分片，但是為了演示，我們這裡只設定3個主分片和一組從分片（每個主分片有一個從分片對應）：

```Js
PUT /blogs
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 1
   }
}
```
現在，我們的叢集看起來就像下圖所示了**有索引的單節點叢集**，這三個主分片都被分配在 `Node 1`。

![有索引的單節點叢集](../images/02-02_one_node.png)

如果我們現在檢視 **叢集健康(cluster-health)** ，我們將得到如下資訊：

```Js
{
   "cluster_name":          "elasticsearch",
   "status":                "yellow", <1>
   "timed_out":             false,
   "number_of_nodes":       1,
   "number_of_data_nodes":  1,
   "active_primary_shards": 3,
   "active_shards":         3,
   "relocating_shards":     0,
   "initializing_shards":   0,
   "unassigned_shards":     3 <2>
}
```

1. 叢集的 `status` 為 `yellow`.
2. 我們的三個從分片還沒有被分配到節點上。

叢集的健康狀況 `yellow` 意味著所有的 **主分片(primary shards)** 啟動並且運行了，這時叢集已經可以成功的處理任意請求，但是 **從分片(replica shards)** 沒有完全被啟用。事實上，當前這三個從分片都處於 `unassigned`（未分配）的狀態，它們還未被分配到節點上。在同一個節點上儲存相同的資料副本是沒有必要的，如果這個節點故障了，就等同於所有的資料副本也丟失了。

現在我們的叢集已經可用了，但是依舊存在因硬體故障而導致資料丟失的風險。
